import{_ as x}from"./CoreTable.vue_vue_type_style_index_0_lang-D8LkGZdJ.js";import{_ as y}from"./SectionTitleLineWithButton-CvP-kldM.js";import{_ as S}from"./CardBox-B8VuaoGy.js";import{_ as F}from"./FormField-Cnx0pd2b.js";import{_ as C}from"./FormControl-C_nPUmK8.js";import{_ as D}from"./BaseButton-YqB03AwT.js";import{_ as R}from"./BaseButtons--tE85GFf.js";import{r as v}from"./@inertiajs-DE7H7qLl.js";import{a as w}from"./axios-ngrFHoWO.js";import{E as L}from"./jspdf-aMcTLUx4.js";import"./jspdf-autotable-TLQB5wf7.js";import{_ as B}from"./app-VaUb3FJr.js";import{Q as r,x as p,y as m,H as l,J as d,D as u,K as T,F as A}from"./@vue-DhfKueGL.js";import"./moment-T1pcntrQ.js";import"./call-bind-apply-helpers-zm886y3p.js";import"./function-bind-CHqF18-c.js";import"./es-errors-CFxpeikN.js";import"./html2pdf.js-p1DVm4cu.js";import"./html2canvas-CBrSDip1.js";import"./@mdi-Ds8bXjTD.js";import"./BaseIcon-BVVkr6PJ.js";import"./pinia-DPcN--oA.js";import"./qs-DlAKVIfT.js";import"./side-channel-CCwe-Ttv.js";import"./object-inspect-CiOUnV34.js";import"./side-channel-list-BCqwI4KF.js";import"./side-channel-map-Bo135rTK.js";import"./get-intrinsic-DYXGad5I.js";import"./es-object-atoms-Ditt1eQ6.js";import"./math-intrinsics-Cv-yPkyD.js";import"./gopd-fcd2-aIC.js";import"./es-define-property-bDCdrV83.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-CQl1k7Za.js";import"./dunder-proto-tAQ_MH3o.js";import"./hasown-DwiY0sux.js";import"./call-bound-DTEBmFVe.js";import"./side-channel-weakmap-DvnJlOn0.js";import"./lodash-es-BU332SBD.js";import"./@babel-Dehwj3G0.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./lodash-B2PBWGQw.js";import"./laravel-vite-plugin-DEL3ZhID.js";const E={name:"LiquidationReport",components:{CoreTable:x,SectionTitleLineWithButton:y,CardBox:S,FormField:F,FormControl:C,BaseButton:D,BaseButtons:R},props:{liquidationData:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})},summary:{type:Object,default:()=>({})},sites:{type:Array,default:()=>[]}},data(){var e;return{filters:{site_id:((e=this.filters)==null?void 0:e.site_id)||""},loading:!1,localRows:[],tableHeader:[{fieldName:"ref_num",label:"Reference No.",sortable:!0},{fieldName:"employee",label:"Employee",sortable:!0},{fieldName:"branch_name",label:"Site",sortable:!0},{fieldName:"expense_amount",label:"Expense Amount",sortable:!0},{fieldName:"date",label:"Date",sortable:!0,type:"date"},{fieldName:"status",label:"Status",sortable:!0},{fieldName:"description",label:"Description",sortable:!1},{fieldName:"view",label:"View",sortable:!1,type:"slot"}],selectedRecord:{}}},computed:{averageExpense(){return this.summary.total_records===0?0:this.summary.total_expenses/this.summary.total_records},tableRows(){const e=this.localRows.length>0?this.localRows:this.liquidationData;if(!this.filters.site_id)return e;const o=this.filters.site_id;return e.filter(a=>a.branch_id==o)},siteOptions(){return[{id:"",label:"All Sites"},...this.sites.map(e=>({id:e.id,label:e.branch_name}))]}},methods:{onSiteChange(e){this.filters.site_id=e},applyFilters(){this.loading=!0;let e=route("frls.reports.liquidation");w.get(e,{params:{site_id:this.filters.site_id}}).then(o=>{o.data&&o.data.success&&(this.localRows=o.data.liquidationData??[])}).catch(()=>{this.localRows=[]}).finally(()=>{this.loading=!1})},formatCurrency(e){return e?parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"2-digit"}):"N/A"},getStatusClass(e){return{P:"bg-yellow-100 text-yellow-800",O:"bg-blue-100 text-blue-800",A:"bg-green-100 text-green-800",C:"bg-gray-100 text-gray-800",X:"bg-red-100 text-red-800",R:"bg-red-100 text-red-800",FA:"bg-yellow-100 text-yellow-800",FD:"bg-indigo-100 text-indigo-800",FL:"bg-purple-100 text-purple-800"}[e]||"bg-gray-100 text-gray-800"},getStatusText(e){return{P:"Pending",O:"Open",A:"Approved",C:"Closed",X:"Canceled",R:"Rejected",FA:"For Approval",FD:"For Disbursement",FL:"For Liquidation"}[e]||"Unknown"},openLink(e){this.selectedRecord=e},showDetails(e){this.$emit("triggerTopRightButton","Details",e)},viewDetails(){console.log("View full details for:",this.selectedRecord)},refreshData(){v.get(route("frls.reports.liquidation"),this.filters,{preserveState:!0,preserveScroll:!0})},exportSingleRecord(){console.log("Export single record:",this.selectedRecord)},exportToExcel(){const o=[["Reference No.","Employee","Site","Expense Amount","Date","Status","Description"].join(","),...this.liquidationData.map(i=>[i.ref_num||"",`"${i.employee||""}"`,`"${i.branch_name||""}"`,i.expense_amount||0,this.formatDate(i.date),this.getStatusText(i.status),`"${i.description||"N/A"}"`].join(","))].join(`
`),a=new Blob([o],{type:"text/csv"}),s=window.URL.createObjectURL(a),t=document.createElement("a");t.href=s,t.download=`liquidation_report_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)},exportToPDF(){const e=new L;e.setFontSize(20),e.setFont("helvetica","bold"),e.text("SafExpress Finance System",105,20,{align:"center"}),e.setFontSize(16),e.setFont("helvetica","normal"),e.text("Liquidation Report",105,30,{align:"center"}),e.setFontSize(10),e.text(`Generated on: ${new Date().toLocaleDateString()}`,20,45);let o=55;if(e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Report Filters:",20,o),o+=10,e.setFontSize(10),e.setFont("helvetica","normal"),this.filters.site_id){const t=this.sites.find(i=>i.id==this.filters.site_id);e.text(`Site: ${t?t.branch_name:"All Sites"}`,20,o),o+=8}o+=5,e.setFontSize(12),e.setFont("helvetica","bold"),e.text("Summary:",20,o),o+=10,e.setFontSize(10),e.setFont("helvetica","normal"),e.text(`Total Expenses: ₱${this.formatCurrency(this.summary.total_expenses)}`,20,o),o+=8,e.text(`Total Records: ${this.summary.total_records}`,20,o),o+=8,e.text(`Average Expense: ₱${this.formatCurrency(this.averageExpense)}`,20,o);const a=this.liquidationData.map(t=>[t.ref_num||"",`${t.first_name} ${t.last_name}`,t.branch_name||"",`₱${this.formatCurrency(t.expense_amount)}`,this.formatDate(t.date),this.getStatusText(t.status),t.description||"N/A"]);e.autoTable({head:[["Reference No.","Employee","Site","Expense Amount","Date","Status","Description"]],body:a,startY:o+15,styles:{fontSize:8,cellPadding:3},headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{0:{cellWidth:25},1:{cellWidth:30},2:{cellWidth:25},3:{cellWidth:25},4:{cellWidth:20},5:{cellWidth:20},6:{cellWidth:35}}});const s=e.internal.getNumberOfPages();for(let t=1;t<=s;t++)e.setPage(t),e.setFontSize(8),e.text(`Page ${t} of ${s}`,105,e.internal.pageSize.height-10,{align:"center"}),e.text("SafExpress Finance System - Liquidation Report",20,e.internal.pageSize.height-10);e.save(`liquidation_report_${new Date().toISOString().split("T")[0]}.pdf`)}}},N={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 items-end"},k={class:"flex md:justify-start"},q={key:1,class:"text-gray-500 text-center py-8"};function $(e,o,a,s,t,i){const f=r("SectionTitleLineWithButton"),h=r("FormControl"),_=r("FormField"),c=r("BaseButton"),b=r("CoreTable"),g=r("CardBox");return m(),p(A,null,[l(f,{icon:"mdiReceiptText",title:"Liquidation Report",main:""}),l(g,{class:"mb-6"},{default:d(()=>[u("div",N,[l(_,{label:"Warehouse"},{default:d(()=>[l(h,{modelValue:t.filters.site_id,"onUpdate:modelValue":[o[0]||(o[0]=n=>t.filters.site_id=n),i.onSiteChange],options:i.siteOptions},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1}),u("div",k,[l(c,{color:"contrast",icon:"mdiCloudDownloadOutline",label:"Get Report Data",class:"self-end",onClick:i.applyFilters},null,8,["onClick"])])]),t.loading||i.tableRows.length>0?(m(),T(b,{key:0,"table-rows":i.tableRows,"table-header":t.tableHeader,"table-name":"Liquidation Report","searchable-fields":"ref_num,employee,branch_name,description","is-paginated":!1,loading:t.loading,onOpenLink:i.openLink},{"row-action":d(({slotProp:n})=>[l(c,{color:"info",icon:"mdiEye",label:"View",onClick:O=>i.showDetails(n)},null,8,["onClick"])]),_:1},8,["table-rows","table-header","loading","onOpenLink"])):(m(),p("div",q," No liquidation records found. Adjust your filters to view data. "))]),_:1})],64)}const Te=B(E,[["render",$],["__scopeId","data-v-e10b6743"]]);export{Te as default};
