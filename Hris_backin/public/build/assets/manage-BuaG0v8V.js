import{b as ot,w as vt,r as b,e as qt,o as Ft,x as p,y as m,H as i,J as u,I as n,D as s,N as F,L as f,M as Vt,F as V,z as I,C as kt}from"./@vue-DhfKueGL.js";import{a as wt,u as Dt}from"./@inertiajs-DE7H7qLl.js";import{_ as St}from"./CardBox-B8VuaoGy.js";import{_ as g}from"./FormField-Cnx0pd2b.js";import{_ as x}from"./FormControl-C_nPUmK8.js";import{_ as k}from"./BaseButton-YqB03AwT.js";import{_ as w}from"./BaseIcon-BVVkr6PJ.js";import{_ as Ct}from"./SectionTitleLineWithButton-CvP-kldM.js";import{_ as Rt}from"./SwalConfirm.vue_vue_type_script_setup_true_lang-DKkGdSL9.js";import{_ as Ut,a as $}from"./TabContent.vue_vue_type_script_setup_true_lang-q9K3_bPd.js";import{s as Lt}from"./service-CLgXUwp_.js";import"./qs-DlAKVIfT.js";import"./side-channel-CCwe-Ttv.js";import"./es-errors-CFxpeikN.js";import"./object-inspect-CiOUnV34.js";import"./call-bind-apply-helpers-zm886y3p.js";import"./function-bind-CHqF18-c.js";import"./side-channel-list-BCqwI4KF.js";import"./side-channel-map-Bo135rTK.js";import"./get-intrinsic-DYXGad5I.js";import"./es-object-atoms-Ditt1eQ6.js";import"./math-intrinsics-Cv-yPkyD.js";import"./gopd-fcd2-aIC.js";import"./es-define-property-bDCdrV83.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-CQl1k7Za.js";import"./dunder-proto-tAQ_MH3o.js";import"./hasown-DwiY0sux.js";import"./call-bound-DTEBmFVe.js";import"./side-channel-weakmap-DvnJlOn0.js";import"./axios-ngrFHoWO.js";import"./lodash-es-BU332SBD.js";import"./app-VaUb3FJr.js";import"./jspdf-aMcTLUx4.js";import"./@babel-Dehwj3G0.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./lodash-B2PBWGQw.js";import"./pinia-DPcN--oA.js";import"./laravel-vite-plugin-DEL3ZhID.js";import"./@mdi-Ds8bXjTD.js";import"./html2pdf.js-p1DVm4cu.js";import"./html2canvas-CBrSDip1.js";import"./Modal.vue_vue_type_script_setup_true_lang-DpTllPHL.js";import"./Dropdown-5dMGiR8k.js";/* empty css                                              */const Ot={key:0,class:"flex flex-col items-center justify-center gap-2"},jt={key:0,class:"mb-2"},At=["src"],It={key:1,class:"mb-2"},$t={class:"flex items-center gap-2"},Tt={class:"text-sm text-gray-600"},Bt={key:1,class:"flex flex-col items-center justify-center gap-2"},Mt={key:0,class:"mb-2"},zt=["src"],Et={key:1,class:"mb-2"},Nt={class:"flex items-center gap-2"},Pt={class:"text-sm text-gray-600"},Jt=["href"],Qt={key:2},Wt={class:"fixed bottom-6 right-6 md:bottom-8 md:right-8 z-50 flex items-center gap-3"},Yt={class:"space-y-4"},Ht={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Kt={class:"mb-6"},Gt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},Xt={class:"text-sm"},Zt={class:"text-sm"},te={class:"text-sm"},ee={class:"text-sm"},oe={key:0,class:"mb-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={class:"flex-1 min-w-0"},ie=["title"],le={class:"text-xs text-gray-500"},ne=["href"],re={class:"mt-4"},de={class:"overflow-x-auto border rounded"},ue={class:"min-w-full text-sm"},ce={class:"px-2 py-1"},pe={class:"px-2 py-1"},me={class:"px-2 py-1"},fe={class:"px-2 py-1"},_e={class:"px-2 py-1 text-right"},ge={class:"px-2 py-1 text-right"},xe={class:"px-2 py-1 text-right"},ye={class:"border-t"},be={class:"px-2 py-1 text-right font-bold"},_o={__name:"manage",props:{action:String,formdata:Object},emits:["triggerTopRightButton"],setup(st,{emit:at}){var J,Q,W,Y,H,K,G,X,Z,tt,et;let h=Lt();const d=st,T=at,B=wt(),_=(J=B.props.auth)==null?void 0:J.user,a=Dt({_token:B.props.csrf_token,id:((Q=d.formdata)==null?void 0:Q.id)||null,user_id:((W=d.formdata)==null?void 0:W.user_id)??(_==null?void 0:_.id)??null,branch_id:((Y=d.formdata)==null?void 0:Y.branch_id)??(_==null?void 0:_.branch_id)??null,request_date:((H=d.formdata)==null?void 0:H.request_date)||"",expectedliquidation_date:(K=d.formdata)!=null&&K.expectedliquidation_date?d.formdata.expectedliquidation_date.toString().slice(0,10):"",purpose:((G=d.formdata)==null?void 0:G.purpose)||null,quotation:null,documents:((X=d.formdata)==null?void 0:X.documents)||[],status_request:((Z=d.formdata)==null?void 0:Z.status_request)||"FA",items:(tt=d.formdata)!=null&&tt.items?JSON.parse(JSON.stringify(d.formdata.items)):[{account_code_title:"",frequency:"",description:"",qty:0,unit_price:0,amount:0,remarks:""}]}),M=ot(()=>{const e=a.items||[];return e.length===0?!1:e.every(t=>{const o=t.account_code_title,l=t.frequency,r=!!(o&&(typeof o=="object"?o.id||o.label:o)),L=!!(l&&(typeof l=="object"?l.id:l)),y=!!(t.description&&t.description.toString().trim()),O=(parseFloat(t.qty)||0)>0,j=(parseFloat(t.unit_price)||0)>0,A=(parseFloat(t.amount)||0)>0;return r&&L&&y&&O&&j&&A})});vt(()=>d.formdata,(e,t)=>{if(e!=t&&e)for(let o in e)e.hasOwnProperty(o)&&(o==="items"?a[o]=JSON.parse(JSON.stringify(e[o])):o==="expectedliquidation_date"||o==="request_date"?a[o]=e[o]?e[o].toString().slice(0,10):"":a[o]=e[o])});const D=b(!1),it=b([]),v=b(((et=d.formdata)==null?void 0:et.quotation)||null),c=b(null),S=e=>e.slice((e.lastIndexOf(".")-1>>>0)+2),C=e=>{if(e instanceof File)return e.type.startsWith("image/");if(typeof e=="string"){const t=S(e).toLowerCase();return["jpg","jpeg","png","gif","webp"].includes(t)}return!1},R=e=>{let t="";if(e instanceof File){const o=e.name;t=S(o).toLowerCase()}else typeof e=="string"&&(t=S(e).toLowerCase());switch(t){case"pdf":return"mdiFilePdfBox";case"doc":case"docx":return"mdiFileWordBox";case"xls":case"xlsx":return"mdiFileExcelBox";default:return"mdiFileDocument"}},lt=async()=>{if(!M.value){h.error("Please complete all required (*) fields in the items list");return}D.value=!0},nt=()=>{a.items.push({account_code_title:"",frequency:"",description:"",qty:0,unit_price:0,amount:0})},rt=e=>{a.items.length>1&&a.items.splice(e,1)},dt=()=>{a.user_id||(a.user_id=(_==null?void 0:_.id)??null),a.branch_id||(a.branch_id=(_==null?void 0:_.branch_id)??null),a.status_request||(a.status_request="FA"),a.items=a.items.map(e=>({...e,account_code_title:typeof e.account_code_title=="object"?e.account_code_title.id??e.account_code_title.label??"":e.account_code_title,frequency:typeof e.frequency=="object"?e.frequency.id??"":e.frequency,qty:typeof e.qty=="string"?parseFloat(e.qty)||0:e.qty||0,unit_price:typeof e.unit_price=="string"?parseFloat(e.unit_price)||0:e.unit_price||0,amount:typeof e.amount=="string"?parseFloat(e.amount)||0:e.amount||0})),a.post(route("frls.form.store"),{preserveScroll:!0,onSuccess:()=>{T("triggerTopRightButton","lists"),h.success("Fund request saved successfully!")},onError:e=>{it.value=Object.values(e||{}),h.error("Failed to save fund request")}})},ut=()=>{},q=b(null),ct=()=>{q.value.click()},pt=e=>{const t=e.target.files[0];if(t){if(t.size>10*1024*1024){h.error("File size exceeds 10MB limit");return}c.value&&URL.revokeObjectURL(c.value),a.quotation=t,C(t)?c.value=URL.createObjectURL(t):c.value=null}},mt=e=>{const t=e.dataTransfer.files[0];if(t){if(t.size>10*1024*1024){h.error("File size exceeds 10MB limit");return}if(!["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.type)){h.error("Invalid file type (PDF, Images, Word, Excel only)");return}c.value&&URL.revokeObjectURL(c.value),a.quotation=t,C(t)?c.value=URL.createObjectURL(t):c.value=null}},ft=()=>{a.quotation=null,c.value&&(URL.revokeObjectURL(c.value),c.value=null),q.value&&(q.value.value="")};qt(()=>{c.value&&URL.revokeObjectURL(c.value)});const z=b([]),E=b([]),_t=async()=>{try{const e=await axios.get("/frls/transaction-code/frls-frequincy");e.data.success&&(z.value=e.data.data.map(t=>({id:t.id,label:t.description})))}catch(e){console.error("Error fetching frequency types:",e)}},gt=async()=>{try{const e=await axios.get("/frls/transaction-code/frls-account-code");e.data.success&&(E.value=e.data.data.map(t=>({id:t.description,label:t.description})))}catch(e){console.error("Error fetching transaction types:",e)}};Ft(async()=>{var e,t;if(await _t(),await gt(),d.action==="Manage"&&((e=d.formdata)!=null&&e.id))try{const o=await axios.get(route("frls.form.show",d.formdata.id));if(o.data.success&&o.data.data){const l=o.data.data;l.items&&l.items.length>0?a.items=JSON.parse(JSON.stringify(l.items)):(!a.items||a.items.length===0)&&(a.items=[{account_code_title:"",frequency:"",description:"",qty:0,unit_price:0,amount:0,remarks:""}]),l.purpose&&(a.purpose=l.purpose),l.request_date&&(a.request_date=l.request_date.toString().slice(0,10)),l.expectedliquidation_date&&(a.expectedliquidation_date=l.expectedliquidation_date.toString().slice(0,10)),l.quotation&&(v.value=l.quotation),l.documents&&(a.documents=l.documents)}}catch(o){console.error("Failed to fetch fresh data",o)}if(!((t=d.formdata)!=null&&t.id)){const o=new Date,l=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),L=String(o.getDate()).padStart(2,"0");a.request_date=`${l}-${r}-${L}`;const y=new Date(o);y.setDate(y.getDate()+1);const O=y.getFullYear(),j=String(y.getMonth()+1).padStart(2,"0"),A=String(y.getDate()).padStart(2,"0");a.expectedliquidation_date=`${O}-${j}-${A}`}});const N=e=>{const t=parseFloat(e.qty)||0,o=parseFloat(e.unit_price)||0;e.amount=t*o},P=e=>e?new Date(e).toLocaleDateString():"N/A",xt=e=>({FA:"For Approval",A:"Approved",R:"Rejected"})[e]||e,yt=e=>{const t=e.account_code_title;return typeof t=="object"&&t?t.label||t.id||"":t},bt=e=>{const t=e.frequency;return typeof t=="object"&&t?t.label||t.id||"":t},U=e=>(parseFloat(e)||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ht=ot(()=>{const e=new Date,t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().split("T")[0]});return(e,t)=>(m(),p(V,null,[i(Ct,{icon:"mdiFileDocumentPlus",title:(d.action==="Add"?"Add":"Edit")+" Fund Request",main:""},{default:u(()=>[i(k,{onClick:t[0]||(t[0]=o=>T("triggerTopRightButton","lists")),icon:"mdiViewList",label:"Request Lists",color:"contrast","rounded-full":"",small:""})]),_:1},8,["title"]),i(St,null,{default:u(()=>[i(Ut,{onOnComplete:lt,color:"#094899","step-size":"xs","finish-disabled":!M.value,"next-disabled":o=>o===0&&!(n(a).purpose&&n(a).purpose.toString().trim())},{default:u(()=>[i($,{title:"Fund Request Information",icon:"mdiFileDocumentPlus"},{default:u(()=>[s("div",null,[i(g,{label:"Request Date",help:"Required. Request Date"},{default:u(()=>[i(x,{name:"request_date",modelValue:n(a).request_date,"onUpdate:modelValue":t[1]||(t[1]=o=>n(a).request_date=o),type:"date",disabled:""},null,8,["modelValue"])]),_:1}),i(g,{label:"Expected Liquidation Date"},{default:u(()=>[i(x,{name:"expectedliquidation_date",modelValue:n(a).expectedliquidation_date,"onUpdate:modelValue":t[2]||(t[2]=o=>n(a).expectedliquidation_date=o),type:"date",min:ht.value},null,8,["modelValue","min"])]),_:1}),i(g,{label:"Purpose"},{default:u(()=>[i(x,{name:"purpose",modelValue:n(a).purpose,"onUpdate:modelValue":t[3]||(t[3]=o=>n(a).purpose=o),type:"text"},null,8,["modelValue"])]),_:1}),i(g,{label:"Quotation (Optional)"},{default:u(()=>[s("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors cursor-pointer",onDragover:t[5]||(t[5]=F(()=>{},["prevent"])),onDrop:F(mt,["prevent"]),onClick:ct},[s("input",{type:"file",ref_key:"fileInput",ref:q,class:"hidden",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx",onChange:pt},null,544),n(a).quotation?(m(),p("div",Ot,[c.value?(m(),p("div",jt,[s("img",{src:c.value,class:"h-32 w-auto object-contain rounded border border-gray-200"},null,8,At)])):(m(),p("div",It,[i(w,{path:R(n(a).quotation),size:"48",class:"text-gray-500"},null,8,["path"])])),s("div",$t,[s("span",Tt,f(n(a).quotation.name||"File selected"),1),i(k,{icon:"mdiClose",color:"danger",small:"","rounded-full":"",onClick:F(ft,["stop"])})])])):v.value?(m(),p("div",Bt,[C(v.value)?(m(),p("div",Mt,[s("img",{src:"/storage/"+v.value,class:"h-32 w-auto object-contain rounded border border-gray-200"},null,8,zt)])):(m(),p("div",Et,[i(w,{path:R(v.value),size:"48",class:"text-gray-500"},null,8,["path"])])),s("div",Nt,[s("span",Pt,[t[7]||(t[7]=Vt("Current: ",-1)),s("a",{href:"/storage/"+v.value,target:"_blank",class:"text-blue-600 hover:underline",onClick:t[4]||(t[4]=F(()=>{},["stop"]))},"View File",8,Jt)]),t[8]||(t[8]=s("span",{class:"text-xs text-gray-400 mx-2"},"|",-1)),t[9]||(t[9]=s("span",{class:"text-sm text-gray-500"},"Click to replace",-1))])])):(m(),p("div",Qt,[i(w,{path:"mdiCloudUpload",size:"36",class:"text-gray-400 mx-auto mb-2"}),t[10]||(t[10]=s("p",{class:"text-sm text-gray-500"},"Drag and drop a file here, or click to upload",-1)),t[11]||(t[11]=s("p",{class:"text-xs text-gray-400 mt-1"},"PDF, Images, Word, Excel (Max 10MB)",-1))]))],32)]),_:1})])]),_:1}),i($,{title:"List of Items",icon:"mdiFormatListBulleted"},{default:u(()=>[s("div",null,[s("div",Wt,[i(k,{onClick:nt,class:"lg:w-12 lg:h-12",icon:"mdiPlus",color:"info","rounded-full":"",small:""})]),s("div",Yt,[(m(!0),p(V,null,I(n(a).items,(o,l)=>(m(),p("div",{key:l,class:"relative rounded-2xl border border-gray-200 p-4 shadow-sm transition-shadow focus-within:border-blue-600 focus-within:shadow-md focus-within:ring-2 focus-within:ring-blue-500"},[s("div",Ht,[i(g,{label:"Account Title*"},{default:u(()=>[i(x,{options:E.value,modelValue:o.account_code_title,"onUpdate:modelValue":r=>o.account_code_title=r},null,8,["options","modelValue","onUpdate:modelValue"])]),_:2},1024),i(g,{label:"Frequency*"},{default:u(()=>[i(x,{options:z.value,modelValue:o.frequency,"onUpdate:modelValue":r=>o.frequency=r},null,8,["options","modelValue","onUpdate:modelValue"])]),_:2},1024),i(g,{label:"Description*"},{default:u(()=>[i(x,{modelValue:o.description,"onUpdate:modelValue":r=>o.description=r,placeholder:"Description"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),i(g,{label:"Qty*"},{default:u(()=>[i(x,{modelValue:o.qty,"onUpdate:modelValue":r=>o.qty=r,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"0",onInput:r=>N(o)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),i(g,{label:"Unit Price*"},{default:u(()=>[i(x,{modelValue:o.unit_price,"onUpdate:modelValue":r=>o.unit_price=r,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"0",onInput:r=>N(o)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),i(g,{label:"Amount*"},{default:u(()=>[i(x,{modelValue:o.amount,"onUpdate:modelValue":r=>o.amount=r,modelModifiers:{number:!0},type:"number",step:"0.01",placeholder:"0",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),i(g,{label:"Remarks"},{default:u(()=>[i(x,{modelValue:o.remarks,"onUpdate:modelValue":r=>o.remarks=r,type:"text",placeholder:"Remarks"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),i(k,{onClick:r=>rt(l),icon:"mdiDelete",color:"danger","rounded-full":"",class:"lg:w-12 lg:h-12 absolute bottom-3 right-2 mt-5"},null,8,["onClick"])])]))),128))])])]),_:1}),i($,{title:"Review",icon:"mdiEye"},{default:u(()=>[s("div",Kt,[t[20]||(t[20]=s("h3",{class:"text-lg font-bold mb-4"},"Review Fund Request",-1)),s("div",Gt,[s("div",null,[t[12]||(t[12]=s("div",{class:"text-xs text-gray-500 uppercase"},"Purpose",-1)),s("div",Xt,f(n(a).purpose),1)]),s("div",null,[t[13]||(t[13]=s("div",{class:"text-xs text-gray-500 uppercase"},"Request Date",-1)),s("div",Zt,f(P(n(a).request_date)),1)]),s("div",null,[t[14]||(t[14]=s("div",{class:"text-xs text-gray-500 uppercase"},"Expected Liquidation",-1)),s("div",te,f(P(n(a).expectedliquidation_date)),1)]),s("div",null,[t[15]||(t[15]=s("div",{class:"text-xs text-gray-500 uppercase"},"Status",-1)),s("div",ee,f(xt(n(a).status_request)),1)])]),n(a).documents&&n(a).documents.length>0?(m(),p("div",oe,[t[16]||(t[16]=s("div",{class:"text-xs text-gray-500 uppercase mb-2"},"Attached Documents",-1)),s("div",se,[(m(!0),p(V,null,I(n(a).documents,o=>(m(),p("div",{key:o.id,class:"flex items-center gap-3 p-3 border rounded-lg bg-gray-50"},[i(w,{path:R(o.original_filename),size:"24",class:"text-gray-500"},null,8,["path"]),s("div",ae,[s("div",{class:"text-sm font-medium text-gray-900 truncate",title:o.original_filename},f(o.original_filename),9,ie),s("div",le,f((o.file_size/1024).toFixed(2))+" KB ",1)]),s("a",{href:"/storage/"+o.file_path,target:"_blank",class:"text-blue-600 hover:underline text-sm whitespace-nowrap"},"View",8,ne)]))),128))])])):kt("",!0),s("div",re,[t[19]||(t[19]=s("div",{class:"text-xs text-gray-500 uppercase mb-2"},"Items",-1)),s("div",de,[s("table",ue,[t[18]||(t[18]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-2 py-1 text-left"},"No."),s("th",{class:"px-2 py-1 text-left"},"Account Code"),s("th",{class:"px-2 py-1 text-left"},"Frequency"),s("th",{class:"px-2 py-1 text-left"},"Description"),s("th",{class:"px-2 py-1 text-right"},"Qty"),s("th",{class:"px-2 py-1 text-right"},"Unit Price"),s("th",{class:"px-2 py-1 text-right"},"Amount")])],-1)),s("tbody",null,[(m(!0),p(V,null,I(n(a).items,(o,l)=>(m(),p("tr",{key:l,class:"border-t even:bg-gray-50"},[s("td",ce,f(l+1),1),s("td",pe,f(yt(o)),1),s("td",me,f(bt(o)),1),s("td",fe,f(o.description),1),s("td",_e,f(o.qty),1),s("td",ge,f(U(o.unit_price)),1),s("td",xe,f(U(o.amount)),1)]))),128))]),s("tfoot",null,[s("tr",ye,[t[17]||(t[17]=s("td",{colspan:"6",class:"px-2 py-1 text-right font-semibold"},"Total Amount:",-1)),s("td",be,"â‚±"+f(U(n(a).items.reduce((o,l)=>o+(parseFloat(l.amount)||0),0))),1)])])])])])])]),_:1})]),_:1},8,["finish-disabled","next-disabled"]),i(Rt,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=o=>D.value=o),type:"warning",title:"Are you sure?",text:"Once submitted, you cannot undo this action!",confirmText:"Submit",cancelText:"Cancel",onConfirm:dt,onCancel:ut},null,8,["modelValue"])]),_:1})],64))}};export{_o as default};
