import{r as f,b as _,o as W,w as B,x as u,y as d,H as n,I as s,J as g,K as M,C as v,D as t,B as X,L as k,N as Y,F as E,z as Z,O as $,R as O}from"./@vue-DhfKueGL.js";import{A as ee}from"./AdminLayout-8Nvj6Q27.js";import{a as le,u as re,h as te,r as h}from"./@inertiajs-DE7H7qLl.js";import{_ as oe}from"./CardBox-B8VuaoGy.js";import{_ as se}from"./CoreTable.vue_vue_type_style_index_0_lang-D8LkGZdJ.js";import{_ as R}from"./FormControl-C_nPUmK8.js";import{_ as ae}from"./AsideDrawer-DLoyHTrP.js";import{_ as ie}from"./SectionTitleLineWithButton-CvP-kldM.js";import{_ as ne}from"./BaseButtons--tE85GFf.js";import{_ as y}from"./BaseButton-YqB03AwT.js";import{s as de}from"./service-CLgXUwp_.js";import{_ as me}from"./app-VaUb3FJr.js";import"./AdminPanelNavbar-Bdvrohd_.js";import"./BaseIcon-BVVkr6PJ.js";import"./@mdi-Ds8bXjTD.js";import"./Dropdown-5dMGiR8k.js";import"./DropdownLink-Bo-pNtpR.js";import"./axios-ngrFHoWO.js";import"./Modal.vue_vue_type_script_setup_true_lang-DpTllPHL.js";import"./FormField-Cnx0pd2b.js";import"./Footer-D5LPszYR.js";import"./qs-DlAKVIfT.js";import"./side-channel-CCwe-Ttv.js";import"./es-errors-CFxpeikN.js";import"./object-inspect-CiOUnV34.js";import"./call-bind-apply-helpers-zm886y3p.js";import"./function-bind-CHqF18-c.js";import"./side-channel-list-BCqwI4KF.js";import"./side-channel-map-Bo135rTK.js";import"./get-intrinsic-DYXGad5I.js";import"./es-object-atoms-Ditt1eQ6.js";import"./math-intrinsics-Cv-yPkyD.js";import"./gopd-fcd2-aIC.js";import"./es-define-property-bDCdrV83.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-CQl1k7Za.js";import"./dunder-proto-tAQ_MH3o.js";import"./hasown-DwiY0sux.js";import"./call-bound-DTEBmFVe.js";import"./side-channel-weakmap-DvnJlOn0.js";import"./lodash-es-BU332SBD.js";import"./moment-T1pcntrQ.js";import"./html2pdf.js-p1DVm4cu.js";import"./html2canvas-CBrSDip1.js";import"./pinia-DPcN--oA.js";/* empty css                                              */import"./jspdf-aMcTLUx4.js";import"./@babel-Dehwj3G0.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./lodash-B2PBWGQw.js";import"./laravel-vite-plugin-DEL3ZhID.js";const ue={class:"permissions-list"},pe={key:1,class:"text-muted"},ce={class:"flex gap-2"},fe={key:1,class:"text-gray-500"};const _e={key:0,class:"mb-4 text-red-500"},ge={class:"mb-4"},be={key:0,class:"text-red-500 text-sm mt-1"},ve={class:"mb-4"},ye={class:"mb-4"},xe={key:0,class:"text-red-500 text-sm mt-1"},ke={class:"mb-4 permissions-section p-4 border border-gray-200 rounded bg-gray-50 dark:bg-gray-800 dark:border-gray-700"},we={class:"flex gap-4 items-center"},Ae={class:"flex items-center gap-2"},he={class:"flex items-center gap-2"},Ne={key:0,class:"text-red-500 text-sm mt-2"},Ve={class:"mt-4 flex flex-col gap-3"},Re={__name:"List",props:{masterlist:{type:[Array,Object],default:()=>[]},roles:{type:Array,default:()=>[]},menus:{type:Array,default:()=>[]},apps:{type:Array,default:()=>[]}},emits:["triggerTopRightButton"],setup(F,{emit:Ce}){const a=F,p=f(!1),c=f(null);f(!1);const b=f([]),L=_(()=>c.value&&c.value.id===0?"Add Menu Role":"Edit Menu Role"),w=de(),x=f([]),P=le();W(()=>{});const m=f("view"),T=_(()=>a.roles.map(l=>({text:l.name,value:l.id}))),U=_(()=>a.apps.map(l=>({text:l.name,value:l.id}))),r=re({_token:P.props.csrf_token,id:null,role_id:null,app_id:null,menu_id:null,role_name:"",menu_name:"",permission:"",created_at:"",updated_at:""}),D=_(()=>{let l=a.menus;return r.app_id&&(l=a.menus.filter(e=>e.app_id===r.app_id)),l.map(e=>({text:e.name,value:e.id}))}),j=()=>{x.value=[],r.permission=m.value,r.id&&r.id!==0?r.put(route("admin.menu-role.update",r.id),{onSuccess:()=>{w.success("Role menu assignment updated successfully!"),p.value=!1,c.value=null,h.reload({only:["masterlist"],preserveScroll:!0})},onError:l=>{x.value=Object.values(l||{}),w.error("Please check the form for errors.")}}):r.post(route("admin.menu-role.store"),{onSuccess:()=>{w.success("Role menu assignment created successfully!"),p.value=!1,c.value=null,h.reload({only:["masterlist"],preserveScroll:!0})},onError:l=>{x.value=Object.values(l||{}),w.error("Please check the form for errors.")}})};B(c,l=>{if(l){if(r.id=l.id||null,r.role_id=l.role_id||null,r.menu_id=l.menu_id||null,r.role_name=l.role_name||"",r.menu_name=l.menu_name||"",r.permission=l.permission||"",r.created_at=l.created_at||"",r.updated_at=l.updated_at||"",l.menu_id){const e=a.menus.find(i=>i.id===l.menu_id);e&&e.app_id?r.app_id=e.app_id:r.app_id=null}else r.app_id=null;l.permission==="manage"?m.value="manage":m.value="view",console.log("Final permissionType:",m.value),console.log("Final form.permission:",r.permission)}},{deep:!0}),B(m,l=>{console.log("permissionType changed to:",l),r.permission=l,console.log("Updated form.permission to:",r.permission)});const N=_(()=>{if(!a.masterlist)return[];let l=[];return Array.isArray(a.masterlist)?l=a.masterlist:a.masterlist&&typeof a.masterlist=="object"&&(a.masterlist.data&&Array.isArray(a.masterlist.data)?l=a.masterlist.data:l=Object.values(a.masterlist)),l.map(e=>{var i,o,A;return{id:e.id,role_id:e.role_id,menu_id:e.menu_id,role_name:e.role&&e.role.name?e.role.code?`${e.role.name} (${e.role.code})`:e.role.name:"N/A",application_name:((o=(i=e.menu)==null?void 0:i.app)==null?void 0:o.name)||"N/A",menu_name:((A=e.menu)==null?void 0:A.name)||"N/A",permission:e.permission||"",created_at:e.created_at,updated_at:e.updated_at,actions:e.id}})}),I=l=>{c.value=l,p.value=!0},z=async l=>{if(confirm("Are you sure you want to delete this role menu assignment?"))try{await h.delete(route("admin.menu-role.destroy",l.id),{preserveScroll:!0,onSuccess:()=>{p.value=!1,c.value=null},onError:e=>{alert("Error deleting role menu assignment. Please try again.")}})}catch{alert("Error deleting role menu assignment. Please try again.")}},H=()=>{c.value={id:0,role_id:null,menu_id:null,permission:""},p.value=!0,m.value="view",r.app_id=null},J=l=>{b.value=l},K=async()=>{if(confirm(`Are you sure you want to delete ${b.value.length} selected items?`))try{await h.delete(route("admin.menu-role.bulk-destroy"),{data:{ids:b.value.map(l=>l.id)},preserveScroll:!0,onSuccess:()=>{b.value=[]},onError:l=>{alert("Error deleting items. Please try again.")}})}catch{alert("Error deleting items. Please try again.")}},C=f("All Applications");_(()=>{const l=new Set;return N.value.forEach(e=>{e.application_name&&l.add(e.application_name)}),["All Applications",...Array.from(l)]});const V=_(()=>C.value==="All Applications"?N.value:N.value.filter(l=>l.application_name===C.value)),q=l=>{c.value=l,p.value=!0},G=[{label:"ID",fieldName:"id"},{label:"Role",fieldName:"role_name",type:"link"},{label:"Application",fieldName:"application_name"},{label:"Menu",fieldName:"menu_name"},{label:"Permission",fieldName:"permission",type:"slot",slotName:"permissions"},{label:"Actions",fieldName:"actions",type:"slot",slotName:"actions"}],S=l=>l?l==="manage"?{label:"Full Management",color:"info"}:l==="view"?{label:"View Only",color:"success"}:{label:l,color:"warning"}:{label:"No permission",color:"warning"},Q=l=>{const e={info:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-200 dark:bg-blue-900 dark:text-blue-100 dark:border-blue-800",success:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200 dark:bg-green-900 dark:text-green-100 dark:border-green-800",warning:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 border border-yellow-200 dark:bg-yellow-900 dark:text-yellow-100 dark:border-yellow-800",danger:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-200 dark:bg-red-900 dark:text-red-100 dark:border-red-800"};return e[l]??e.warning};return(l,e)=>(d(),u(E,null,[n(s(te),{title:"Role Menu"}),n(ee,null,{default:g(()=>[n(ie,{icon:"mdiListBox",title:"Role Menu",main:""},{default:g(()=>[n(ne,null,{default:g(()=>[b.value.length>0&&b.value.length<V.value.length?(d(),M(y,{key:0,icon:"mdiDelete",label:"Remove",color:"danger","rounded-full":"",small:"",onClick:K})):v("",!0),n(y,{icon:"mdiPlus",label:"Add Role Menu",color:"info","rounded-full":"",small:"",onClick:H})]),_:1})]),_:1}),n(oe,{class:"flex-1 p-6","has-table":""},{default:g(()=>[V.value.length>0?(d(),M(se,{key:0,"table-rows":V.value,"table-header":G,"table-name":"role-menu-assignments","searchable-fields":"role_name,menu_name,permission,application_name,created_at","is-paginated":!0,"is-show-row-checkbox":!0,onCheckRows:J,onOpenLink:q},{permissions:g(({slotProp:i})=>[t("div",ue,[i.permission?(d(),u("span",{key:0,class:X([Q(S(i.permission).color),"mr-1 mb-1"])},k(S(i.permission).label),3)):(d(),u("span",pe," No permission "))])]),actions:g(({slotProp:i})=>[t("div",ce,[n(y,{small:"",color:"warning",onClick:o=>I(i.raw_item||i),label:"Edit"},null,8,["onClick"]),n(y,{small:"",color:"danger",onClick:o=>z(i.raw_item||i),label:"Delete"},null,8,["onClick"])])]),_:1},8,["table-rows"])):(d(),u("div",fe,"No role menu assignments found"))]),_:1}),n(ae,{title:L.value,"is-open":p.value,onCloseDrawer:e[6]||(e[6]=i=>p.value=!1),class:"shadow-lg shadow-blue-500/50"},{default:g(()=>[v("",!0),t("form",{onSubmit:Y(j,["prevent"])},[x.value.length?(d(),u("div",_e,[t("ul",null,[(d(!0),u(E,null,Z(x.value,(o,A)=>(d(),u("li",{key:A},k(o),1))),128))])])):v("",!0),t("div",ge,[e[8]||(e[8]=t("label",{class:"font-bold dark:text-gray-200 mb-2 block"},"Role",-1)),n(R,{modelValue:s(r).role_id,"onUpdate:modelValue":e[0]||(e[0]=o=>s(r).role_id=o),options:T.value,type:"select",placeholder:"Select a role",class:"w-full"},null,8,["modelValue","options"]),s(r).errors.role_id?(d(),u("div",be,k(s(r).errors.role_id),1)):v("",!0)]),t("div",ve,[e[9]||(e[9]=t("label",{class:"font-bold dark:text-gray-200 mb-2 block"},"Application",-1)),n(R,{modelValue:s(r).app_id,"onUpdate:modelValue":e[1]||(e[1]=o=>s(r).app_id=o),options:U.value,type:"select",placeholder:"Select an application",class:"w-full"},null,8,["modelValue","options"])]),t("div",ye,[e[10]||(e[10]=t("label",{class:"font-bold dark:text-gray-200 mb-2 block"},"Menu",-1)),n(R,{modelValue:s(r).menu_id,"onUpdate:modelValue":e[2]||(e[2]=o=>s(r).menu_id=o),options:D.value,type:"select",placeholder:"Select a menu",class:"w-full",disabled:!s(r).app_id},null,8,["modelValue","options","disabled"]),s(r).errors.menu_id?(d(),u("div",xe,k(s(r).errors.menu_id),1)):v("",!0)]),t("div",ke,[e[13]||(e[13]=t("h4",{class:"font-bold dark:text-gray-200 mb-3"},"Permission Type",-1)),t("div",we,[t("label",Ae,[$(t("input",{type:"radio",value:"view","onUpdate:modelValue":e[3]||(e[3]=o=>m.value=o),class:"text-blue-600 focus:ring-blue-500"},null,512),[[O,m.value]]),e[11]||(e[11]=t("span",{class:"dark:text-gray-200"},"View Only",-1))]),t("label",he,[$(t("input",{type:"radio",value:"manage","onUpdate:modelValue":e[4]||(e[4]=o=>m.value=o),class:"text-blue-600 focus:ring-blue-500"},null,512),[[O,m.value]]),e[12]||(e[12]=t("span",{class:"dark:text-gray-200"},"Full Management",-1))])]),s(r).errors.permission?(d(),u("div",Ne,k(s(r).errors.permission),1)):v("",!0)]),t("div",Ve,[n(y,{type:"submit",label:s(r).id===0||!s(r).id?"Create Assignment":"Update Assignment",color:"info",loading:s(r).processing},null,8,["label","loading"]),n(y,{label:"Close",color:"danger",outline:"",onClick:e[5]||(e[5]=o=>p.value=!1)})])],32)]),_:1},8,["title","is-open"])]),_:1})],64))}},Sl=me(Re,[["__scopeId","data-v-2770c111"]]);export{Sl as default};
