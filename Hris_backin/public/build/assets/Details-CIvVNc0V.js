import{_ as L}from"./SectionTitleLineWithButton-CvP-kldM.js";import{_ as q}from"./CardBox-B8VuaoGy.js";import{_ as k}from"./BaseButton-YqB03AwT.js";import{a as w}from"./axios-ngrFHoWO.js";import{h as C}from"./html2pdf.js-p1DVm4cu.js";import{Q as f,x as a,y as l,H as c,D as t,J as _,C as p,L as n,F as g,z as y,N as x,A as S,M as v}from"./@vue-DhfKueGL.js";import{_ as F}from"./app-VaUb3FJr.js";import"./BaseIcon-BVVkr6PJ.js";import"./@mdi-Ds8bXjTD.js";import"./@inertiajs-DE7H7qLl.js";import"./qs-DlAKVIfT.js";import"./side-channel-CCwe-Ttv.js";import"./es-errors-CFxpeikN.js";import"./object-inspect-CiOUnV34.js";import"./call-bind-apply-helpers-zm886y3p.js";import"./function-bind-CHqF18-c.js";import"./side-channel-list-BCqwI4KF.js";import"./side-channel-map-Bo135rTK.js";import"./get-intrinsic-DYXGad5I.js";import"./es-object-atoms-Ditt1eQ6.js";import"./math-intrinsics-Cv-yPkyD.js";import"./gopd-fcd2-aIC.js";import"./es-define-property-bDCdrV83.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-CQl1k7Za.js";import"./dunder-proto-tAQ_MH3o.js";import"./hasown-DwiY0sux.js";import"./call-bound-DTEBmFVe.js";import"./side-channel-weakmap-DvnJlOn0.js";import"./lodash-es-BU332SBD.js";import"./html2canvas-CBrSDip1.js";import"./jspdf-aMcTLUx4.js";import"./@babel-Dehwj3G0.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./lodash-B2PBWGQw.js";import"./pinia-DPcN--oA.js";import"./laravel-vite-plugin-DEL3ZhID.js";const T={name:"LiquidationDetailsPage",components:{SectionTitleLineWithButton:L,CardBox:q,BaseButton:k},props:{formdata:{type:Object,default:()=>({})}},data(){return{loading:!1,data:{form:{},items:[],liquidation:[],disbursement:null},summary:{requested_total:0,liquidated_total:0,variance:0},lightboxOpen:!1,lightboxImage:"",zoom:1,translateX:0,translateY:0,dragging:!1,dragOriginX:0,dragOriginY:0}},watch:{formdata:{immediate:!0,async handler(r){if(!(!r||!r.form_id)){this.loading=!0;try{let e=`/frls/reports/liquidation-detail/${r.form_id}`;try{typeof route=="function"&&(e=route("frls.reports.liquidation-detail",r.form_id))}catch{}const d=await w.get(e);d.data&&d.data.success&&(this.data=d.data,d.data.summary&&(this.summary=d.data.summary))}catch(e){console.error("Failed to load details",e)}finally{this.loading=!1}}}}},methods:{formatCurrency(r){return r?parseFloat(r).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatDate(r){return r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"2-digit"}):"N/A"},formatDateTime(r){return r?new Date(r).toLocaleString("en-US",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"N/A"},getStatusText(r){return{P:"Pending",O:"Open",A:"Approved",C:"Closed",X:"Canceled",R:"Rejected",FA:"For Approval",FD:"For Disbursement",FL:"For Liquidation"}[r]||"Unknown"},openLightbox(r){this.lightboxImage=r,this.lightboxOpen=!0},closeLightbox(){this.lightboxOpen=!1,this.lightboxImage="",this.zoom=1,this.translateX=0,this.translateY=0,this.dragging=!1},onLightboxWheel(r){const e=r.deltaY<0?.1:-.1,d=this.zoom+e;this.zoom=Math.min(4,Math.max(.5,d))},onDragStart(r){this.dragging=!0,this.dragOriginX=r.clientX-this.translateX,this.dragOriginY=r.clientY-this.translateY},onDragMove(r){this.dragging&&(this.translateX=r.clientX-this.dragOriginX,this.translateY=r.clientY-this.dragOriginY)},onDragEnd(){this.dragging=!1},onTouchStart(r){const e=r.touches[0];this.dragging=!0,this.dragOriginX=e.clientX-this.translateX,this.dragOriginY=e.clientY-this.translateY},onTouchMove(r){const e=r.touches[0];this.dragging&&(this.translateX=e.clientX-this.dragOriginX,this.translateY=e.clientY-this.dragOriginY)},downloadPDF(){const r=document.getElementById("exportPDF"),e=r.querySelector(".pdf-header");e&&e.classList.remove("hidden-on-screen");const d=`${this.data.form.frm_no||"FRM"}_${this.data.form.branch_name||"Branch"}.pdf`,h={margin:[10,10,10,10],filename:d,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};C().from(r).set(h).toPdf().get("pdf").then(i=>{const o=i.internal.getNumberOfPages();for(let m=1;m<=o;m++)i.setPage(m),i.setFontSize(10),i.text(`Page ${m} of ${o}`,i.internal.pageSize.getWidth()-30,i.internal.pageSize.getHeight()-10)}).output("bloburl").then(i=>{window.open(i,"_blank"),e&&e.classList.add("hidden-on-screen")})}}},O={id:"exportPDF"},B={key:0,class:"p-6"},X={key:1},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},A={class:"text-sm"},P={class:"text-sm"},M={class:"text-sm"},R={class:"text-sm"},E={class:"text-sm"},N={class:"text-sm"},z={class:"text-sm"},j={key:0},I={class:"text-sm"},W={key:1},V={class:"text-sm"},U={class:"mt-4"},H={class:"overflow-x-auto border rounded"},Q={class:"min-w-full text-sm"},J={class:"px-2 py-1"},G={class:"px-2 py-1"},K={class:"px-2 py-1"},Z={class:"px-2 py-1"},$={class:"px-2 py-1 text-right"},tt={class:"px-2 py-1 text-right"},et={class:"px-2 py-1 text-right"},st={class:"border-t"},ot={class:"px-2 py-1 text-right font-bold"},it={class:"mt-6"},rt={class:"overflow-x-auto border rounded"},nt={class:"min-w-full text-sm"},at={class:"px-2 py-1"},lt={class:"px-2 py-1"},dt={class:"px-2 py-1"},mt={class:"px-2 py-1 text-right"},ut={class:"px-2 py-1 text-right"},ct={class:"px-2 py-1"},pt={class:"px-2 py-1"},gt=["onClick"],xt=["src"],ht={key:1},ft=["src"],yt={class:"mt-8 space-y-3"},_t={class:"ml-2"},vt={class:"ml-2"},bt={key:0},Dt={class:"ml-2"},Lt={class:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6"},qt={class:"font-semibold"};function kt(r,e,d,h,i,o){const m=f("BaseButton"),b=f("SectionTitleLineWithButton"),D=f("CardBox");return l(),a("div",null,[c(b,{icon:"mdiReceiptText",title:"Fund Request Details",main:""},{default:_(()=>[t("div",null,[c(m,{class:"mr-2",onClick:e[0]||(e[0]=s=>r.$emit("triggerTopRightButton","lists")),icon:"mdiViewList",label:"Request Lists",color:"contrast","rounded-full":"",small:""}),c(m,{onClick:o.downloadPDF,icon:"mdiFile",label:"PDF",color:"danger","rounded-full":"",small:""},null,8,["onClick"])])]),_:1}),t("div",O,[c(D,{class:"mb-6"},{default:_(()=>[e[30]||(e[30]=t("div",{class:"pdf-header hidden-on-screen mb-6"},[t("div",{class:"flex justify-between items-center mb-4"},[t("div",{class:"text-left flex items-center"},[t("div",null,[t("h2",{class:"text-2xl font-bold leading-tight",style:{color:"#003399","font-family":"Arial, sans-serif"}}," Fund Request and "),t("h3",{class:"text-lg font-normal leading-tight",style:{color:"#4a6b9c","font-family":"Arial, sans-serif"}}," Liquidation System ")])]),t("img",{src:"/asset/logo.png",alt:"Logo",class:"h-20"})]),t("div",{class:"text-center"},[t("h1",{class:"text-2xl font-bold uppercase tracking-wide decoration-double underline"},"Liquidation Report")])],-1)),i.loading?(l(),a("div",B,"Loading...")):(l(),a("div",X,[t("div",Y,[t("div",null,[e[11]||(e[11]=t("div",{class:"text-xs text-gray-500 uppercase"},"Request No",-1)),t("div",A,n(i.data.form.frm_no),1)]),t("div",null,[e[12]||(e[12]=t("div",{class:"text-xs text-gray-500 uppercase"},"Purpose",-1)),t("div",P,n(i.data.form.purpose),1)]),t("div",null,[e[13]||(e[13]=t("div",{class:"text-xs text-gray-500 uppercase"},"Request Date",-1)),t("div",M,n(o.formatDate(i.data.form.request_date)),1)]),t("div",null,[e[14]||(e[14]=t("div",{class:"text-xs text-gray-500 uppercase"},"Site",-1)),t("div",R,n(i.data.form.branch_name),1)]),t("div",null,[e[15]||(e[15]=t("div",{class:"text-xs text-gray-500 uppercase"},"Expected Liquidation",-1)),t("div",E,n(o.formatDate(i.data.form.expectedliquidation_date)),1)]),t("div",null,[e[16]||(e[16]=t("div",{class:"text-xs text-gray-500 uppercase"},"Status",-1)),t("div",N,n(o.getStatusText(i.data.form.status_request)),1)]),t("div",null,[e[17]||(e[17]=t("div",{class:"text-xs text-gray-500 uppercase"},"Employee",-1)),t("div",z,n(i.data.form.employee_name),1)]),i.data.disbursement?(l(),a("div",j,[e[18]||(e[18]=t("div",{class:"text-xs text-gray-500 uppercase"},"Disbursement No",-1)),t("div",I,n(i.data.disbursement.disbursement_no),1)])):p("",!0),i.data.disbursement?(l(),a("div",W,[e[19]||(e[19]=t("div",{class:"text-xs text-gray-500 uppercase"},"Disbursement Status",-1)),t("div",V,n(o.getStatusText(i.data.disbursement.status)),1)])):p("",!0)]),t("div",U,[e[22]||(e[22]=t("div",{class:"text-xs text-gray-500 uppercase mb-2"},"Items",-1)),t("div",H,[t("table",Q,[e[21]||(e[21]=t("thead",{class:"bg-info"},[t("tr",null,[t("th",{class:"px-2 py-1 text-left"},"No."),t("th",{class:"px-2 py-1 text-left"},"Account Code"),t("th",{class:"px-2 py-1 text-left"},"Frequency"),t("th",{class:"px-2 py-1 text-left"},"Description"),t("th",{class:"px-2 py-1 text-right"},"Qty"),t("th",{class:"px-2 py-1 text-right"},"Unit Price"),t("th",{class:"px-2 py-1 text-right"},"Amount")])],-1)),t("tbody",null,[(l(!0),a(g,null,y(i.data.items,(s,u)=>(l(),a("tr",{key:u,class:"border-t even:bg-gray-50 dark:even:bg-slate-800"},[t("td",J,n(u+1),1),t("td",G,n(s.account_code_title),1),t("td",K,n(s.frequency_label),1),t("td",Z,n(s.description),1),t("td",$,n(s.qty),1),t("td",tt,n(o.formatCurrency(s.unit_price)),1),t("td",et,n(o.formatCurrency(s.amount)),1)]))),128))]),t("tfoot",null,[t("tr",st,[e[20]||(e[20]=t("td",{colspan:"6",class:"px-2 py-1 text-right font-semibold"},"Total Amount:",-1)),t("td",ot,"₱"+n(o.formatCurrency(i.data.items.reduce((s,u)=>s+(parseFloat(u.amount)||0),0))),1)])])])])]),t("div",it,[e[24]||(e[24]=t("div",{class:"text-xs text-gray-500 uppercase mb-2"},"Liquidation Details",-1)),t("div",rt,[t("table",nt,[e[23]||(e[23]=t("thead",{class:"bg-info"},[t("tr",null,[t("th",{class:"px-2 py-1 text-left"},"Date"),t("th",{class:"px-2 py-1 text-left"},"OR No"),t("th",{class:"px-2 py-1 text-left"},"Description"),t("th",{class:"px-2 py-1 text-right"},"Expense Amount"),t("th",{class:"px-2 py-1 text-right"},"Input VAT"),t("th",{class:"px-2 py-1 text-left"},"Status"),t("th",{class:"px-2 py-1 text-left"},"Receipt")])],-1)),t("tbody",null,[(l(!0),a(g,null,y(i.data.liquidation,s=>(l(),a("tr",{key:s.id,class:"border-t even:bg-gray-50 dark:even:bg-slate-800"},[t("td",at,n(o.formatDate(s.date)),1),t("td",lt,n(s.or_no||"—"),1),t("td",dt,n(s.description||"—"),1),t("td",mt,"₱"+n(o.formatCurrency(s.expense_amount)),1),t("td",ut,n(o.formatCurrency(s.input_vat)),1),t("td",ct,n(s.vat_non_vat||"—"),1),t("td",pt,[s.thumbnail_url?(l(),a("div",{key:0,class:"h-16 w-16 overflow-hidden rounded cursor-pointer",onClick:u=>o.openLightbox(s.thumbnail_url)},[t("img",{src:s.thumbnail_url,alt:"",class:"h-16 w-16 object-cover"},null,8,xt)],8,gt)):(l(),a("span",ht,"—"))])]))),128))])])])])])),i.lightboxOpen?(l(),a("div",{key:2,class:"fixed inset-0 z-50 bg-black/80 select-none",onClick:e[10]||(e[10]=x((...s)=>o.closeLightbox&&o.closeLightbox(...s),["self"]))},[t("button",{type:"button",class:"absolute top-4 right-4 bg-white/20 hover:bg-white/30 text-white rounded-full h-10 w-10 flex items-center justify-center text-xl",onClick:e[1]||(e[1]=(...s)=>o.closeLightbox&&o.closeLightbox(...s))},"✕"),t("div",{class:"w-full h-full flex items-center justify-center",onWheel:e[9]||(e[9]=x((...s)=>o.onLightboxWheel&&o.onLightboxWheel(...s),["prevent"]))},[t("img",{src:i.lightboxImage,alt:"",class:"object-contain max-w-none",style:S({transform:`translate(${i.translateX}px, ${i.translateY}px) scale(${i.zoom})`,cursor:i.dragging?"grabbing":"grab"}),onMousedown:e[2]||(e[2]=(...s)=>o.onDragStart&&o.onDragStart(...s)),onMousemove:e[3]||(e[3]=(...s)=>o.onDragMove&&o.onDragMove(...s)),onMouseup:e[4]||(e[4]=(...s)=>o.onDragEnd&&o.onDragEnd(...s)),onMouseleave:e[5]||(e[5]=(...s)=>o.onDragEnd&&o.onDragEnd(...s)),onTouchstart:e[6]||(e[6]=x((...s)=>o.onTouchStart&&o.onTouchStart(...s),["prevent"])),onTouchmove:e[7]||(e[7]=x((...s)=>o.onTouchMove&&o.onTouchMove(...s),["prevent"])),onTouchend:e[8]||(e[8]=(...s)=>o.onDragEnd&&o.onDragEnd(...s))},null,44,ft)],32)])):p("",!0),t("div",yt,[t("div",null,[e[25]||(e[25]=t("span",{class:"font-semibold"},"Disbursed Fund Request:",-1)),t("span",_t,"₱"+n(o.formatCurrency(i.summary.requested_total)),1)]),t("div",null,[e[26]||(e[26]=t("span",{class:"font-semibold"},"Liquidated Expenses:",-1)),t("span",vt,"₱"+n(o.formatCurrency(i.summary.liquidated_total)),1)]),i.summary.variance!==0?(l(),a("div",bt,[e[27]||(e[27]=t("span",{class:"font-semibold"},"Variance:",-1)),t("span",Dt,"₱"+n(o.formatCurrency(i.summary.variance)),1)])):p("",!0)]),t("div",Lt,[i.data.approval_details&&i.data.approval_details.length>0?(l(!0),a(g,{key:0},y(i.data.approval_details,(s,u)=>(l(),a("div",{key:u},[t("div",null,[t("span",qt,n(s.approver_name),1)]),t("div",null,[e[28]||(e[28]=t("span",{class:"font-semibold"},"Approved by:",-1)),v(" ("+n(s.role_description)+")",1)]),t("div",null,[e[29]||(e[29]=t("span",{class:"font-semibold"},"Approved Date and Time:",-1)),v(" "+n(o.formatDateTime(s.approved_date)),1)])]))),128)):(l(),a(g,{key:1},[],64))])]),_:1})])])}const ce=F(T,[["render",kt],["__scopeId","data-v-f5a04a25"]]);export{ce as default};
